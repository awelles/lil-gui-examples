<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example One</title>
</head>

<body>
    <h3>params object:</h3>
    <div id="params"></div>
    <div>
        <h3>Test .listen()</h3>
        <div><label for="number">params.number:</label>
            <button id="number">Set to 0.25</button>
        </div>
        <div><label for="numberStr">params.numberStr:</label>
            <button id="numberStr">Set to "0.25"</button>
            ( controller fails to respond to this change )
        </div>
        <div><label for="numberStr2">params.numberStr2:</label>
            <button id="numberStr2">Set to "0.25"</button>
        </div>
    </div>
    <script type="module">
        import { GUI } from '/dist/lil-gui.esm.js';

        const gui = new GUI();

        const params = {
            number: 0.5,
            numberStr: '0.5',
            numberStr2: '0.5',
        }

        /*
          A normal NumberController with .listen()
        */
        gui.add( params, 'number', 0, 1 ).step( 0.01 ).listen();

        /*
          Preserving string type method 1:
          Create an intermidiate object, use onChange to update original params object
          Works fine, but .listen() ability is lost
        */
        const obj1 = { numberStr: parseFloat( params.numberStr ) };
        gui.add( obj1, 'numberStr', 0, 1 ).step( 0.01 )
            .onChange( () => {
                params.numberStr = obj1.numberStr.toString();
            } )
            .listen();

        /*
            Preserving string type method 2:
            Create an intermidiate object with getter/setter
            .listen() works, converting on every getValue
            .onChange()/onFinishChange() are still free, as conversion is invisible to controller
        */
        const obj2 = {};
        Object.defineProperties( obj2, {
            num2: {
                get: function () { return parseFloat( params.numberStr2 ); },
                set: function ( value ) { params.numberStr2 = value.toString(); }
            },
        } );
        gui.add( obj2, 'num2', 0, 1 ).step( 0.01 )
            .listen();

        // --------------------------------------------------

        const printParams = function ( params, container ) {
            container.innerHTML = `<pre>${ JSON.stringify( params, null, 2 ) }</pre>`
        }
        const refreshHtml = function () {
            printParams( params, document.getElementById( 'params' ) );
        }

        gui.onChange( refreshHtml );

        printParams( params, document.getElementById( 'params' ) );

        document.getElementById( 'number' ).addEventListener( 'click', function () { params.number = 0.25; refreshHtml(); } );
        document.getElementById( 'numberStr' ).addEventListener( 'click', function () { params.numberStr = '0.25'; refreshHtml(); } );
        document.getElementById( 'numberStr2' ).addEventListener( 'click', function () { params.numberStr2 = '0.25'; refreshHtml(); } );

        globalThis.params = params; // In case you'd like to hand-tweak in the browser console
    </script>
</body>

</html>